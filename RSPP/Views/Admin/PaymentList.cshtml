@{
    ViewBag.Title = "Payment List";
    Layout = "~/Views/Shared/_ElaLayout.cshtml";
}
<div class="content">
    <div class="row">
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-12">
                    <div class="panel">
                        <header class="panel-heading panel-border">
                            <h3 class="text-primary"> payment Report </h3>
                            
                                <div class="pull-right" style="margin-right:25px">
                                    <div class="row">

                                        <div class="col-md-12">
                                            <div class="panel short-states" style="background-color:#eaeef3; margin-right:50px">
                                                <div class="panel-title">
                                                </div>
                                                <div class="panel-body">
                                                    <h1><span class="col-md-offset-1 text-danger">@TempData["totalpaymentcount"] </span></h1>
                                                    <small class="label label-danger" style="font-size:15px">Total Count</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            
                        </header>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-2">

                                    <div class="input-group">

                                        <div class="input-group-addon" style="background-color:orange"><i class="fa fa-calendar"></i></div>
                                        <div><input type="date" class="min form-control" autocomplete="off" id="min" name="min" placeholder="From" /></div>
                                    </div>
                                </div><div class="col-md-3">
                                    <div class="input-group">
                                        <div class="input-group-addon" style="background-color:yellowgreen"><i class="fa fa-calendar"></i></div>
                                        <div><input type="date" class="maxdate form-control" autocomplete="off" id="maxdate" name="maxdate" placeholder="To" /></div>
                                        <div class="input-group-addon" style="background-color:red">
                                            <button id="searchdate" class="fa fa-search" style="margin-left:-4px; background-color:red; margin-top:-10px; border:none"></button>
                                        </div>

                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="input-group">
                                        <div class="input-group-addon" style="background-color:darkred">
                                            <span class="fa fa-home"></span>
                                        </div>
                                        <div><input id="companyemail" name="companyemail" placeholder="search by company email" class="form-control companyemail" /></div>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <input type="button" class="btn btn-danger" id="all" name="all" value="Show All Record" />
                                </div>
                            </div><br /><br />





                            <div class="row" style="margin-top:-100px">

                                <div class="col-md-3">
                                    <div class="input-group">
                                        <select id="appstatus" name="appstatus" class="form-control">
                                            <option disabled selected>--Search By Application Status--</option>
                                            <option value="Processing">PROCESSING</option>
                                            <option value="Approved">APPROVED</option>
                                            <option value="Rejected">REJECTED</option>
                                        </select>
                                        <div class="input-group-addon" style="background-color:red">
                                            <button id="clearbtn1" style="margin-left:-4px; background-color:red; margin-top:-10px; border:none; color:white">Clear</button>
                                        </div>
                                    </div>
                                </div>

                            </div><br /><br /><br /><br />



                            <div style="margin-top:-50px" class="col-md-12">
                                <table class="table table-striped table-bordered" id="payment" style="font-size:small">
                                    <thead>
                                        <tr>
                                            <th><strong>ApplicationID</strong> </th>
                                            <th><strong>Remita Ref</strong> </th>
                                            <th><strong>Application Type</strong> </th>
                                            <th><strong>Payment Status</strong> </th>
                                            <th><strong>Agency Name</strong> </th>
                                            <th><strong>Company Email</strong> </th>
                                            <th><strong>Total Amount</strong> </th>
                                            <th><strong>Transaction Date</strong> </th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                    <tfoot>
                                        <tr>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="jumbotron">
        <div id="container" style="min-width: 310px; height: 400px; max-width: 600px; margin: 0 auto">
            <div class="panel short-states">
                <div class="panel-title">
                </div>
                <div class="panel-body img-circle" style="border-radius:100%">
                    <table>
                        <tr class="cell-">
                            <td>
                                <div style="color:darkred; font-weight:bold">₦</div>
                            </td>

                            <td>
                                <div id="totalsum" style="font-weight:bold"></div>
                            </td>

                            <td style="padding:10px">
                                <div id="amtinword" style="font-weight:bold"></div>
                            </td>
                        </tr>
                    </table>
                    <small class="label label-danger" style="font-size:15px">Total Payment</small>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts {

    <script type="text/javascript">
        $(document).ready(function () {


            $("#clearbtn1").click(function () {
                $("#appstatus").val('');
                table.search(this.value).draw();
                table.ajax.reload();
            });



            $("#appstatus").change(function () {
                table.search(this.value).draw();
                table.ajax.reload();
            });



            $("#all").click(function () {
                table.search("All Payment").draw();
            });
            $("#searchdate").click(function () {
                min1 = $(".min").val();
                datemax1 = $(".maxdate").val();
                table.draw();
            });
            var table = $("#payment").DataTable({
                "processing": true,
                "serverSide": true,
                //"search": { "search": "Default_filter" },
                ajax: {
                    url: "/Admin/GetPaymentReport",
                    type: "POST",
                    data: function (d) {
                        debugger;
                        d.mymin = $("#min").val();
                        d.mymax = $("#maxdate").val();
                    },
                    "lengthMenu": [[10, 25, 50, 100], [10, 25, 50, 100]],

                },
                //sDom: 'Blrtip',
                dom: 'Blfrtip',
                columns: [
                    {
                        data: "applicationId"
                    },
                    {
                        data: "rrreference"
                    },
                    {
                        data: "applicationTypeId"
                    },
                    {
                        data: "status"
                    },
                    {
                        data: "agencyName"
                    },
                    {
                        data: "companyEmail"
                    },
                    
                    {
                        data: "txnAmount",

                    },
                    {
                        data: "transactionDate",

                    },
                ],

                "footerCallback": function (row, data, start, end, display) {
                    var api = this.api(), data;
                    debugger;
                    // Remove the formatting to get integer data for summation
                    var intVal = function (i) {
                        return typeof i === 'string' ?
                            i.replace(/[\$,]/g, '') * 1 :
                            typeof i === 'number' ?
                                i : 0;
                    };

                    // Total over this page
                    pageTotal = api
                        .column(6, { filter: 'applied' })
                        .data()
                        .reduce(function (a, b) {
                            return intVal(a) + intVal(b);
                        }, 0);

                    // Update footer
                    debugger;
                    $(api.column(6).footer()).html(
                        'Total= ' + '₦' + pageTotal,
                        $("#totalsum").text(pageTotal),
                        $("#amtinword").text("(" + numberToWords(Number(pageTotal)) + ")"),
                    );


                }
            });
            
            $(".companyemail").autocomplete({
                source: function (request, response) {
                    debugger;
                    $.ajax({
                        url: '/Admin/AutoSearchCompanyAppId',
                        type: "GET",
                        datatype: "json",
                        data: {
                            term: request.term
                        },
                        success: function (data) {
                            response($.map(data,
                                function (val, item) {

                                    return { label: val.textvalue, value: val.textvalue, companyemail: val.textvalue, }
                                }));
                        }

                    });
                },

                select: function (event, ui) {
                    debugger;
                    $(".companyemail").val(ui.item.companyemail);
                    var textvalue = $(".companyemail").val();
                    table.search(this.value).draw();
                    table.draw();
                }
            });
        });



        function numberToWords(number) {
            var digit = ['zero', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine'];
            var elevenSeries = ['ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
            var countingByTens = ['twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
            var shortScale = ['', 'thousand', 'million', 'billion', 'trillion'];

            number = number.toString(); number = number.replace(/[\, ]/g, ''); if (number != parseFloat(number)) return 'not a number'; var x = number.indexOf('.'); if (x == -1) x = number.length; if (x > 15) return 'too big'; var n = number.split(''); var str = ''; var sk = 0; for (var i = 0; i < x; i++) { if ((x - i) % 3 == 2) { if (n[i] == '1') { str += elevenSeries[Number(n[i + 1])] + ' '; i++; sk = 1; } else if (n[i] != 0) { str += countingByTens[n[i] - 2] + ' '; sk = 1; } } else if (n[i] != 0) { str += digit[n[i]] + ' '; if ((x - i) % 3 == 0) str += 'hundred '; sk = 1; } if ((x - i) % 3 == 1) { if (sk) str += shortScale[(x - i - 1) / 3] + ' '; sk = 0; } } if (x != number.length) { var y = number.length; str += 'point '; for (var i = x + 1; i < y; i++) str += digit[n[i]] + ' '; } str = str.replace(/\number+/g, ' '); return str.trim() + ".";

        } 


    </script>
}
